#!/bin/bash

# The purpose of this script is to make changes into files generated by
# 'yarn create react-app' after 'build' is run.
# 1. Move files to a new directory called 'user'
#    The resulting structure is 'build/user/static/<etc>'
# 2. Update reference on generated files from

help()
{
   echo ""
   echo "Usage: $0 -f folder_name -s static_folder -t template_folder"
   echo -e "\t-f Folder name"
   echo -e "\t-s Static folder directory"
   echo -e "\t-t Template folder directory"
   exit 1 # Exit script after printing help
}

while getopts "f:s:t:" opt
do
   case "$opt" in
      f ) folder_name="$OPTARG" ;;
      s ) static_folder="$OPTARG" ;;
      t ) template_folder="$OPTARG" ;;
      ?  ) help ;; # Print helpFunction in case parameter is non-existent
   esac
done


if [ -z "$folder_name" ] || [ -z "$static_folder" ] || [ -z "$template_folder" ]
then
   echo "Some or all of the parameters are empty";
   helpFunction
fi


echo "Create application folder: $folder_name"
mkdir -p $folder_name
cp -rf build/* $folder_name

#Change favicon url
find $folder_name"/index.html" -type f | xargs sed -i 's/\/favicon.ico/{{ STATIC_URL }}mfview\/favicon.ico/g'
find $folder_name"/index.html" -type f | xargs sed -i 's/\/static\/js/{{ STATIC_URL }}mfview\/static\/js/g'
find $folder_name"/index.html" -type f | xargs sed -i 's/\/static\/css/{{ STATIC_URL }}mfview\/static\/css/g'

#Change logo url
find mfview/static/js/ -type f | xargs sed -i 's/static\/media/static\/geonode\/img/g'

#Change logo url
find mfview/static/js/ -type f | xargs sed -i 's/static\/media/static\/geonode\/img/g'

find mfview/static/js/ -type f | xargs sed -i 's/logo.753248ba.png/logo.png/g'